#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <omp.h>

typedef struct {
    double x, y, z;
} Vector3D;

typedef struct {
    Vector3D position;
    Vector3D velocity;
    double mass;
} Particle;

void compute_forces(Particle *particles, Vector3D *forces, int num_particles, double G) {
    int i, j;
    #pragma omp parallel for private(j)
    for (i = 0; i < num_particles; i++) {
        forces[i].x = forces[i].y = forces[i].z = 0.0;
        for (j = 0; j < num_particles; j++) {
            if (i != j) {
                double dx = particles[j].position.x - particles[i].position.x;
                double dy = particles[j].position.y - particles[i].position.y;
                double dz = particles[j].position.z - particles[i].position.z;
                double distance = sqrt(dx*dx + dy*dy + dz*dz);
                double force_magnitude = G * particles[i].mass * particles[j].mass / (distance * distance);
                double fx = force_magnitude * dx / distance;
                double fy = force_magnitude * dy / distance;
                double fz = force_magnitude * dz / distance;
                #pragma omp atomic
                forces[i].x += fx;
                #pragma omp atomic
                forces[i].y += fy;
                #pragma omp atomic
                forces[i].z += fz;
            }
        }
    }
}

void update_particles(Particle *particles, Vector3D *forces, int num_particles, double dt) {
    int i;
    #pragma omp parallel for
    for (i = 0; i < num_particles; i++) {
        particles[i].velocity.x += forces[i].x / particles[i].mass * dt;
        particles[i].velocity.y += forces[i].y / particles[i].mass * dt;
        particles[i].velocity.z += forces[i].z / particles[i].mass * dt;
        particles[i].position.x += particles[i].velocity.x * dt;
        particles[i].position.y += particles[i].velocity.y * dt;
        particles[i].position.z += particles[i].velocity.z * dt;
    }
}

void simulate(Particle *particles, int num_particles, int num_steps, double dt) {
    Vector3D *forces = (Vector3D *)malloc(num_particles * sizeof(Vector3D));
    double G = 6.67430e-11;
    for (int step = 0; step < num_steps; step++) {
        compute_forces(particles, forces, num_particles, G);
        update_particles(particles, forces, num_particles, dt);
    }
    free(forces);
}

int main() {
    int num_particles = 3;
    Particle particles[] = {
    {{ 0.49729, 0.966226, 0.428681 }, { 0.198307, 0.361111, 0.689255 }, 0.223625 * powl(10, 10)},
    {{ 0.964621, 0.821291, 0.419606 }, { 0.662684, 0.587032, 0.16395 }, 0.364583 * powl(10, 10)},
    {{ 0.020512, 0.015483, 0.220429 }, { 0.340974, 0.021423, 0.830723 }, 0.152234 * powl(10, 10)},
    {{ 0.967333, 0.542652, 0.476052 }, { 0.267489, 0.542374, 0.945749 }, 0.289386 * powl(10, 10)},
    {{ 0.129828, 0.036068, 0.901068 }, { 0.341789, 0.620712, 0.605176 }, 0.625194 * powl(10, 10)},
    {{ 0.360191, 0.230534, 0.795457 }, { 0.645617, 0.484988, 0.961972 }, 0.848607 * powl(10, 10)},
    {{ 0.966311, 0.59361, 0.141998 }, { 0.677856, 0.129522, 0.422948 }, 0.943829 * powl(10, 10)},
    {{ 0.973433, 0.26352, 0.962326 }, { 0.091437, 0.564834, 0.232784 }, 0.014364 * powl(10, 10)},
    {{ 0.859302, 0.90352, 0.46878 }, { 0.864171, 0.291022, 0.077413 }, 0.869917 * powl(10, 10)},
    {{ 0.913648, 0.644178, 0.668867 }, { 0.971718, 0.82145, 0.852497 }, 0.349954 * powl(10, 10)},
    {{ 0.474571, 0.435113, 0.346686 }, { 0.269302, 0.337521, 0.651064 }, 0.79614 * powl(10, 10)},
    {{ 0.63553, 0.514166, 0.194046 }, { 0.11376, 0.185229, 0.999429 }, 0.91927 * powl(10, 10)},
    // {{ 0.337199, 0.552609, 0.062849 }, { 0.621895, 0.387267, 0.26104 }, 0.048229 * powl(10, 10)},
    // {{ 0.268739, 0.022628, 0.088143 }, { 0.55434, 0.054505, 0.166009 }, 0.40912 * powl(10, 10)},
    // {{ 0.291631, 0.828481, 0.267247 }, { 0.076515, 0.904426, 0.104356 }, 0.015877 * powl(10, 10)},
    // {{ 0.657862, 0.096674, 0.989178 }, { 0.400286, 0.670163, 0.033804 }, 0.470778 * powl(10, 10)},
    // {{ 0.491933, 0.595681, 0.490272 }, { 0.64436, 0.026368, 0.001726 }, 0.002896 * powl(10, 10)},
    // {{ 0.149253, 0.463883, 0.148714 }, { 0.61047, 0.813769, 0.900787 }, 0.078512 * powl(10, 10)},
    // {{ 0.32549, 0.353276, 0.89694 }, { 0.392989, 0.360712, 0.840914 }, 0.463844 * powl(10, 10)},
    // {{ 0.805278, 0.805775, 0.246314 }, { 0.292244, 0.344603, 0.303058 }, 0.68086 * powl(10, 10)},
    // {{ 0.222949, 0.752638, 0.470463 }, { 0.666596, 0.909513, 0.414118 }, 0.574204 * powl(10, 10)},
    // {{ 0.082422, 0.101012, 0.154715 }, { 0.333919, 0.390793, 0.708286 }, 0.080979 * powl(10, 10)},
    // {{ 0.729779, 0.444508, 0.653359 }, { 0.815015, 0.170687, 0.436886 }, 0.231924 * powl(10, 10)},
    // {{ 0.586038, 0.624083, 0.582049 }, { 0.77914, 0.298181, 0.798155 }, 0.895967 * powl(10, 10)},
    // {{ 0.588488, 0.368978, 0.486223 }, { 0.773964, 0.105256, 0.967223 }, 0.40819 * powl(10, 10)},
    // {{ 0.031132, 0.474265, 0.898597 }, { 0.35256, 0.539692, 0.372052 }, 0.002006 * powl(10, 10)},
    // {{ 0.691276, 0.304891, 0.422904 }, { 0.784717, 0.086241, 0.490591 }, 0.71089 * powl(10, 10)},
    // {{ 0.998364, 0.722404, 0.780388 }, { 0.826482, 0.959093, 0.705401 }, 0.331968 * powl(10, 10)},
    // {{ 0.704985, 0.05893, 0.183418 }, { 0.18145, 0.522978, 0.910273 }, 0.411002 * powl(10, 10)},
    // {{ 0.285354, 0.744384, 0.623163 }, { 0.368664, 0.102869, 0.106428 }, 0.173812 * powl(10, 10)},
    // {{ 0.273837, 0.929514, 0.655939 }, { 0.576644, 0.165277, 0.99278 }, 0.710961 * powl(10, 10)},
    // {{ 0.273943, 0.826513, 0.286916 }, { 0.647024, 0.857143, 0.634475 }, 0.497806 * powl(10, 10)},
    // {{ 0.742063, 0.209612, 0.200248 }, { 0.519495, 0.591139, 0.018868 }, 0.345373 * powl(10, 10)},
    // {{ 0.417464, 0.271189, 0.3493 }, { 0.440566, 0.021249, 0.80781 }, 0.674682 * powl(10, 10)},
    // {{ 0.389957, 0.401021, 0.296247 }, { 0.208192, 0.596301, 0.533015 }, 0.711031 * powl(10, 10)},
    // {{ 0.834972, 0.376129, 0.965651 }, { 0.597389, 0.317178, 0.968535 }, 0.210416 * powl(10, 10)},
    // {{ 0.579495, 0.308247, 0.870535 }, { 0.011897, 0.544221, 0.84937 }, 0.596947 * powl(10, 10)},
    // {{ 0.746881, 0.138551, 0.243939 }, { 0.017088, 0.325986, 0.366284 }, 0.219374 * powl(10, 10)},
    // {{ 0.575991, 0.228942, 0.173059 }, { 0.699292, 0.464666, 0.976208 }, 0.82344 * powl(10, 10)},
    // {{ 0.590757, 0.027593, 0.535214 }, { 0.980398, 0.923907, 0.919095 }, 0.682879 * powl(10, 10)},
    // {{ 0.430751, 0.671063, 0.108777 }, { 0.950967, 0.190205, 0.20884 }, 0.400387 * powl(10, 10)},
    // {{ 0.230799, 0.144841, 0.944709 }, { 0.493808, 0.11794, 0.036982 }, 0.431302 * powl(10, 10)},
    // {{ 0.568984, 0.473633, 0.860632 }, { 0.568428, 0.585057, 0.216417 }, 0.091283 * powl(10, 10)},
    // {{ 0.715271, 0.386684, 0.277823 }, { 0.44398, 0.161369, 0.894641 }, 0.697677 * powl(10, 10)},
    // {{ 0.604428, 0.32421, 0.670776 }, { 0.33806, 0.118026, 0.448249 }, 0.138536 * powl(10, 10)},
    // {{ 0.063452, 0.997773, 0.464648 }, { 0.10803, 0.470542, 0.259783 }, 0.663704 * powl(10, 10)},
    // {{ 0.580646, 0.182981, 0.507968 }, { 0.648082, 0.490993, 0.633615 }, 0.841093 * powl(10, 10)},
    // {{ 0.552233, 0.466679, 0.898469 }, { 0.371056, 0.515617, 0.868882 }, 0.724681 * powl(10, 10)},
    // {{ 0.527276, 0.082694, 0.74663 }, { 0.145129, 0.955212, 0.658381 }, 0.702732 * powl(10, 10)},
    // {{ 0.289269, 0.37608, 0.601761 }, { 0.178907, 0.154776, 0.364963 }, 0.790325 * powl(10, 10)},
    // {{ 0.425512, 0.859283, 0.997058 }, { 0.622239, 0.847227, 0.727668 }, 0.791062 * powl(10, 10)},
    // {{ 0.690408, 0.492828, 0.103617 }, { 0.41131, 0.409951, 0.520855 }, 0.042805 * powl(10, 10)},
    // {{ 0.881794, 0.736236, 0.025806 }, { 0.018016, 0.434621, 0.877162 }, 0.437092 * powl(10, 10)},
    // {{ 0.925038, 0.890448, 0.537575 }, { 0.395514, 0.230565, 0.024906 }, 0.259771 * powl(10, 10)},
    // {{ 0.789221, 0.20577, 0.66895 }, { 0.082697, 0.399813, 0.624382 }, 0.549612 * powl(10, 10)},
    // {{ 0.839819, 0.914597, 0.81342 }, { 0.136772, 0.047869, 0.714099 }, 0.835358 * powl(10, 10)},
    // {{ 0.657407, 0.892011, 0.28949 }, { 0.585527, 0.489645, 0.294612 }, 0.01484 * powl(10, 10)},
    // {{ 0.778477, 0.440054, 0.998518 }, { 0.752305, 0.565332, 0.881101 }, 0.101043 * powl(10, 10)},
    // {{ 0.846455, 0.21389, 0.086035 }, { 0.413388, 0.389452, 0.021429 }, 0.878426 * powl(10, 10)},
    // {{ 0.834205, 0.528876, 0.665281 }, { 0.926719, 0.499648, 0.226586 }, 0.787147 * powl(10, 10)},
    // {{ 0.544353, 0.153656, 0.763462 }, { 0.108441, 0.447106, 0.490576 }, 0.717662 * powl(10, 10)},
    // {{ 0.67124, 0.366686, 0.971948 }, { 0.47048, 0.688912, 0.290708 }, 0.58455 * powl(10, 10)},
    // {{ 0.376837, 0.806091, 0.758861 }, { 0.908695, 0.008962, 0.291408 }, 0.211482 * powl(10, 10)},
    // {{ 0.66096, 0.722782, 0.575495 }, { 0.497487, 0.006378, 0.755288 }, 0.421319 * powl(10, 10)},
    // {{ 0.165193, 0.264943, 0.38698 }, { 0.067068, 0.605447, 0.905312 }, 0.985455 * powl(10, 10)},
    // {{ 0.408447, 0.444039, 0.574892 }, { 0.566494, 0.095764, 0.48196 }, 0.639119 * powl(10, 10)},
    // {{ 0.270549, 0.41528, 0.198744 }, { 0.797573, 0.193147, 0.527243 }, 0.945411 * powl(10, 10)},
    // {{ 0.414573, 0.554456, 0.650862 }, { 0.839169, 0.686742, 0.773225 }, 0.044844 * powl(10, 10)},
    // {{ 0.336702, 0.571435, 0.756871 }, { 0.497698, 0.792055, 0.045255 }, 0.756968 * powl(10, 10)},
    // {{ 0.020659, 0.12341, 0.464834 }, { 0.614418, 0.645611, 0.091153 }, 0.193424 * powl(10, 10)},
    // {{ 0.688309, 0.611049, 0.560572 }, { 0.61469, 0.799217, 0.727092 }, 0.07067 * powl(10, 10)},
    // {{ 0.713209, 0.494889, 0.118482 }, { 0.015222, 0.623615, 0.501786 }, 0.946769 * powl(10, 10)},
    // {{ 0.631375, 0.06439, 0.348622 }, { 0.678764, 0.947303, 0.290369 }, 0.010278 * powl(10, 10)},
    // {{ 0.363794, 0.545814, 0.760501 }, { 0.153223, 0.401919, 0.377989 }, 0.940453 * powl(10, 10)},
    // {{ 0.395161, 0.470745, 0.263711 }, { 0.472279, 0.714007, 0.835228 }, 0.600726 * powl(10, 10)},
    // {{ 0.132768, 0.345369, 0.016265 }, { 0.736783, 0.721443, 0.592199 }, 0.818555 * powl(10, 10)},
    // {{ 0.698784, 0.10818, 0.638967 }, { 0.331395, 0.991772, 0.773892 }, 0.772197 * powl(10, 10)},
    // {{ 0.703972, 0.200412, 0.658317 }, { 0.546908, 0.606999, 0.364755 }, 0.696553 * powl(10, 10)},
    // {{ 0.160148, 0.746918, 0.452697 }, { 0.401129, 0.634284, 0.261652 }, 0.897762 * powl(10, 10)},
    // {{ 0.686596, 0.521139, 0.056446 }, { 0.960203, 0.719214, 0.592986 }, 0.581591 * powl(10, 10)},
    // {{ 0.222746, 0.689911, 0.396262 }, { 0.030369, 0.71123, 0.041269 }, 0.291669 * powl(10, 10)},
    // {{ 0.400944, 0.542641, 0.774241 }, { 0.42425, 0.208271, 0.937362 }, 0.476964 * powl(10, 10)},
    // {{ 0.539677, 0.348585, 0.858989 }, { 0.628086, 0.734074, 0.284148 }, 0.622283 * powl(10, 10)},
    // {{ 0.267879, 0.128957, 0.974642 }, { 0.987771, 0.271601, 0.816421 }, 0.924703 * powl(10, 10)},
    // {{ 0.747303, 0.282673, 0.48004 }, { 0.912521, 0.581844, 0.682498 }, 0.934749 * powl(10, 10)},
    // {{ 0.797005, 0.627899, 0.644023 }, { 0.035587, 0.887592, 0.895491 }, 0.866751 * powl(10, 10)},
    // {{ 0.300206, 0.41566, 0.791628 }, { 0.914272, 0.423545, 0.562377 }, 0.590205 * powl(10, 10)},
    // {{ 0.017365, 0.259671, 0.703267 }, { 0.51266, 0.809381, 0.385785 }, 0.0861 * powl(10, 10)},
    // {{ 0.62644, 0.183431, 0.280551 }, { 0.190048, 0.862091, 0.115583 }, 0.067989 * powl(10, 10)},
    // {{ 0.751435, 0.740568, 0.466633 }, { 0.323614, 0.885957, 0.554232 }, 0.103825 * powl(10, 10)},
    // {{ 0.738063, 0.456609, 0.010106 }, { 0.22467, 0.308562, 0.13857 }, 0.751196 * powl(10, 10)},
    // {{ 0.148207, 0.813286, 0.329348 }, { 0.453707, 0.416498, 0.066362 }, 0.507709 * powl(10, 10)},
    // {{ 0.632076, 0.091732, 0.45661 }, { 0.12763, 0.084244, 0.675223 }, 0.880682 * powl(10, 10)},
    // {{ 0.767818, 0.60295, 0.099404 }, { 0.13728, 0.575917, 0.136873 }, 0.337856 * powl(10, 10)},
    // {{ 0.53614, 0.189524, 0.046348 }, { 0.126631, 0.516366, 0.896737 }, 0.782429 * powl(10, 10)},
    // {{ 0.568147, 0.570556, 0.157869 }, { 0.390027, 0.420885, 0.70766 }, 0.306746 * powl(10, 10)},
    // {{ 0.490962, 0.044515, 0.488376 }, { 0.037273, 0.887531, 0.977432 }, 0.872845 * powl(10, 10)},
    // {{ 0.758477, 0.697072, 0.603499 }, { 0.383815, 0.556047, 0.028005 }, 0.017788 * powl(10, 10)},
    // {{ 0.790379, 0.404022, 0.454202 }, { 0.157827, 0.768548, 0.293887 }, 0.868716 * powl(10, 10)},
    // {{ 0.491631, 0.990048, 0.810397 }, { 0.938405, 0.89366, 0.058849 }, 0.415048 * powl(10, 10)},
};

    simulate(particles, num_particles, 100000, 0.001);

    for (int i = 0; i < num_particles; i++) {
        printf("Particle: position=(%f, %f, %f), velocity=(%f, %f, %f), mass=%f\n",
               particles[i].position.x, particles[i].position.y, particles[i].position.z,
               particles[i].velocity.x, particles[i].velocity.y, particles[i].velocity.z,
               particles[i].mass);
    }

    return 0;
}
